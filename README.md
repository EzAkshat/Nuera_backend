# Nuera AI Chat Server

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

Nuera is a friendly AI chat buddy backend server built with FastAPI. It supports real-time chat, AI-generated responses using Gemini, text-to-speech via ElevenLabs, scheduled reminders, and user authentication. The server uses MongoDB for data persistence and WebSockets for live updates.

## Features

- **AI-Powered Chat**: Engage in conversations with AI responses generated by Google's Gemini model.
- **Reminders**: Create, schedule, and receive notifications for reminders with AI follow-ups.
- **Text-to-Speech**: Convert AI responses to audio streams using ElevenLabs.
- **Speech-to-Text**: Transcribe audio inputs via WebSocket for voice-based interactions.
- **Real-Time Updates**: WebSocket support for chat and reminder broadcasts.
- **Authentication**: JWT-based user authentication for secure access.
- **Timezone Awareness**: Handles reminders in Asia/Kolkata timezone.
- **Persistent Storage**: MongoDB for users, chats, and reminders.

## Prerequisites

- Python 3.10 or higher
- MongoDB instance (local or cloud)
- API keys for:
  - Google Gemini (GEMINI_API_KEY)
  - ElevenLabs (ELEVENLABS_API_KEY)
- Optional: JWT secret key for authentication (JWT_SECRET)

## Installation

1. Clone the repository:
   ```
   git clone https://github.com/yourusername/nuera-ai-chat-server.git
   cd nuera-ai-chat-server
   ```

2. Create a virtual environment and activate it:
   ```
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. Install dependencies:
   ```
   pip install -r requirements.txt
   ```

4. Set up environment variables in a `.env` file:
   ```
   GEMINI_API_KEY=your_gemini_key
   ELEVENLABS_API_KEY=your_elevenlabs_key
   JWT_SECRET=your_jwt_secret
   MONGO_URI=mongodb://localhost:27017
   ```

5. Create necessary directories:
   ```
   mkdir -p static/audio
   ```

## Usage

1. Start the server:
   ```
   uvicorn main:app --reload --port 8000
   ```

2. Authenticate:
   - Use the `/login` endpoint (OAuth2PasswordBearer) to obtain a JWT token.

3. Key Interactions:
   - **Chat via WebSocket**: Connect to `/ws/chat?token=your_jwt` and send JSON messages like `{"message": "Hello", "chat_id": "optional_id"}`.
   - **Create Reminder**: POST `/reminders` with `{"text": "Buy milk", "date": "2025-09-20T10:00:00"}`.
   - **Get Chats/Reminders**: GET `/chat` or `/reminders` (authenticated).

## Examples

### Creating a Reminder (cURL)
```
curl -X POST "http://localhost:8000/reminders" \
-H "Authorization: Bearer your_jwt_token" \
-H "Content-Type: application/json" \
-d '{"text": "Meeting at 3 PM", "date": "2025-09-18T15:00:00"}'
```

### Response
```json
{
  "id": "66e9f1234567890abcdef123",
  "text": "Meeting at 3 PM",
  "date": "2025-09-18T15:00:00",
  "completed": false
}
```

The reminder will trigger at the specified time, sending an AI-generated message via WebSocket.

## API Reference

- **Auth**: `/login` (POST for token)
- **Chat**: `/chat` (GET/DELETE), `/ws/chat` (WebSocket)
- **Reminders**: `/reminders` (POST/GET/PUT/DELETE), `/ws/reminders` (WebSocket)
- **Audio**: `/audio/{message_id}` (GET for TTS audio)
- **Transcription**: `/ws/transcription` (WebSocket for STT)

## Folder Structure

```
server/
├── main.py               # FastAPI app entrypoint
├── database.py           # MongoDB setup and collections
├── config.py             # Environment variables and prompts
├── auth.py               # JWT authentication
├── ai_service.py         # Gemini AI integration
├── reminder_scheduler.py # Reminder scheduling logic
├── websocket_manager.py  # WebSocket connection management
├── text_to_speech.py     # ElevenLabs TTS streaming
├── static/               # Static files (e.g., audio)
│   └── audio/            # Generated audio files
└── .env                  # Environment variables (gitignore this)
```

## Contributing

Contributions are welcome! Follow these steps:

1. Fork the repository.
2. Create a feature branch: `git checkout -b feature/new-feature`.
3. Commit changes: `git commit -m 'Add new feature'`.
4. Push to the branch: `git push origin feature/new-feature`.
5. Open a Pull Request.

Please adhere to PEP 8 style guidelines and include tests for new features.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

- Built with [FastAPI](https://fastapi.tiangolo.com/) for high-performance APIs.
- AI responses powered by [Google Gemini](https://ai.google.dev/).
- TTS via [ElevenLabs](https://elevenlabs.io/).
- Thanks to the open-source community for libraries like Motor, PyJWT, and more.